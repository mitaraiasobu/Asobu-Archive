<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¾¡æ‰‹æ´—éŠã®ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—</title>
<link href="https://fonts.googleapis.com/css2?family=Kaisei+Tokumin:wght@400;500;700;800&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --pink:   #f7a8c4;
  --pinkd:  #d96088;
  --pinkl:  #fff0f6;
  --soft:   #ffd6e8;
  --white:  #ffffff;
  --text:   #c45c7a;
  --textd:  #8a3050;
  --muted:  #d8bcc8;
}

body {
  background: var(--pinkl);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-family: 'Kaisei Tokumin', serif;
  padding: 20px;
  overflow-x: hidden;
}

/* â”€â”€ floating deco â”€â”€ */
.bg-deco { position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden; }
.bg-deco span {
  position:absolute;
  opacity:0;
  color: var(--pinkd);
  animation: rise linear infinite;
  user-select:none;
}
@keyframes rise {
  0%   { transform:translateY(108vh) rotate(-10deg); opacity:0; }
  8%   { opacity:.13; }
  92%  { opacity:.09; }
  100% { transform:translateY(-80px) rotate(15deg); opacity:0; }
}

/* â”€â”€ CARD â”€â”€ */
.card {
  position:relative;
  z-index:1;
  width:100%;
  max-width:980px;
  aspect-ratio:4/3;
  background: var(--white);
  border-radius:24px;
  box-shadow:
    0 0 0 2.5px var(--pink),
    0 0 0 6px #fff,
    0 0 0 8px var(--soft),
    0 16px 52px rgba(210,90,130,.11);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:22px 26px 16px;
  gap:11px;
  overflow:hidden;
}

/* polka dots bg */
.card::before {
  content:'';
  position:absolute;
  inset:0;
  border-radius:24px;
  background-image: radial-gradient(circle, #ffc8de 1.3px, transparent 1.3px);
  background-size:20px 20px;
  opacity:.22;
  pointer-events:none;
}

/* top-right corner heart */
.card::after {
  content:'â™¡';
  position:absolute;
  top:11px; right:15px;
  font-size:17px;
  color:var(--pink);
  opacity:.55;
}

/* â”€â”€ TITLE â”€â”€ */
.title-wrap {
  position:relative; z-index:1;
  text-align:center;
  flex-shrink:0;
}
.title-deco-row {
  display:flex;
  align-items:center;
  justify-content:center;
  gap:7px;
  font-size:13px;
  color:var(--pink);
  letter-spacing:3px;
  margin-bottom:3px;
}
.main-title {
  font-size: clamp(15px,2.5vw,25px);
  font-weight:800;
  color:var(--textd);
  letter-spacing:2px;
  text-shadow:
    2px 3px 0 var(--soft),
    0 0 22px rgba(210,80,120,.14);
  line-height:1.25;
}
.title-sub {
  font-size:10px;
  font-weight:400;
  color:var(--muted);
  letter-spacing:5px;
  margin-top:2px;
}

/* â”€â”€ PANELS â”€â”€ */
.panels-row {
  display:flex;
  gap:16px;
  width:100%;
  flex:1;
  min-height:0;
  position:relative;
  z-index:1;
}
.panel {
  flex:1;
  display:flex;
  flex-direction:column;
  gap:6px;
  min-width:0;
}
.panel-label {
  text-align:center;
  font-size:clamp(11px,1.6vw,15px);
  font-weight:700;
  color:var(--text);
  letter-spacing:3px;
}
.panel-label::before { content:'â™¡ '; color:var(--pink); }
.panel-label::after  { content:' â™¡'; color:var(--pink); }

/* pink border wrapper */
.grid-wrapper {
  flex:1;
  border:1.5px solid var(--pink);
  border-radius:14px;
  padding:9px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(255,255,255,.65);
  position:relative;
}
.grid-wrapper::before {
  content:'â™¡';
  position:absolute;
  top:-8px; left:8px;
  font-size:12px;
  color:var(--pink);
  background:#fff;
  padding:0 3px;
  line-height:1;
}
.grid-wrapper::after {
  content:'â™¡';
  position:absolute;
  bottom:-8px; right:8px;
  font-size:12px;
  color:var(--pink);
  background:#fff;
  padding:0 3px;
  line-height:1;
}

/* â”€â”€ IMAGE GRID â”€â”€ */
.image-grid {
  display:grid;
  grid-template-columns:repeat(var(--cols,3),1fr);
  gap:7px;
  width:100%;
}
.img-cell {
  position:relative;
  aspect-ratio:1;
  cursor:pointer;
  border-radius:9px;
  overflow:hidden;
}
.img-cell img {
  width:100%; height:100%;
  object-fit:contain;
  display:block;
  border-radius:9px;
  transition:transform .18s ease, opacity .18s ease;
}
.img-cell:hover:not(.hidden-mode) img { transform:scale(1.07); }

/* ? overlay */
.qmark-overlay {
  position:absolute;
  inset:0;
  border-radius:9px;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:opacity .18s ease;
}
.qmark-overlay svg { width:70%; height:70%; }

.img-cell.hidden-mode img          { opacity:0; }
.img-cell.hidden-mode .qmark-overlay { opacity:1; }

/* â”€â”€ BOTTOM â”€â”€ */
.bottom-area {
  flex-shrink:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:4px;
  position:relative;
  z-index:1;
}
.bottom-line {
  width:52%;
  height:1.5px;
  background:linear-gradient(90deg,transparent,var(--pink),var(--soft),var(--pink),transparent);
  border-radius:2px;
}
.bottom-text {
  font-size:9px;
  font-weight:400;
  letter-spacing:5px;
  color:var(--muted);
}
.bottom-hearts {
  font-size:13px;
  color:var(--pink);
  letter-spacing:5px;
  opacity:.7;
}

/* â”€â”€ SAVE BUTTON â”€â”€ */
.save-btn {
  margin-top:13px;
  padding:9px 30px;
  background:var(--white);
  border:2px solid var(--pink);
  border-radius:999px;
  color:var(--text);
  font-family:'Kaisei Tokumin',serif;
  font-size:13px;
  font-weight:700;
  letter-spacing:2px;
  cursor:pointer;
  z-index:10;
  transition:all .2s;
  box-shadow:0 3px 14px rgba(210,90,130,.14);
}
.save-btn:hover {
  background:var(--pinkl);
  box-shadow:0 5px 22px rgba(210,90,130,.28);
  transform:translateY(-2px);
}
.save-btn:active { transform:scale(.97); }

.hint {
  font-size:10px;
  font-family:'Kaisei Tokumin',serif;
  color:var(--muted);
  letter-spacing:1px;
  margin-top:5px;
  text-align:center;
}
</style>
</head>
<body>

<div class="bg-deco" id="bgDeco"></div>

<div class="card" id="mainCard">

  <div class="title-wrap">
    <div class="title-deco-row">
      <span>ğŸ€</span><span>â™¡ â™¡ â™¡</span><span>ğŸ€</span>
    </div>
    <div class="main-title">å¾¡æ‰‹æ´—éŠã®ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—</div>
    <div class="title-sub">â€” membership benefits â€”</div>
  </div>

  <div class="panels-row">

    <div class="panel">
      <div class="panel-label">ã‚¹ã‚¿ãƒ³ãƒ—</div>
      <div class="grid-wrapper">
        <div class="image-grid" id="stampGrid">
          <!-- â˜… ã‚¹ã‚¿ãƒ³ãƒ—ç”»åƒã‚’è¿½åŠ ãƒ»å‰Šé™¤ã™ã‚‹ã«ã¯ã“ã“ã‚’ç·¨é›† -->
          <div class="img-cell"><img src="YouTubeã‚¹ã‚¿ãƒ³ãƒ—1.png" alt="1"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="YouTubeã‚¹ã‚¿ãƒ³ãƒ—2.png" alt="2"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="YouTubeã‚¹ã‚¿ãƒ³ãƒ—3.png" alt="3"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="YouTubeã‚¹ã‚¿ãƒ³ãƒ—4.png" alt="4"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="YouTubeã‚¹ã‚¿ãƒ³ãƒ—5.png" alt="5"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="YouTubeã‚¹ã‚¿ãƒ³ãƒ—6.png" alt="6"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="YouTubeã‚¹ã‚¿ãƒ³ãƒ—7.png" alt="7"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="YouTubeã‚¹ã‚¿ãƒ³ãƒ—8.png" alt="8"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="YouTubeã‚¹ã‚¿ãƒ³ãƒ—9.png" alt="9"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="YouTubeã‚¹ã‚¿ãƒ³ãƒ—10.png" alt="10"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="YouTubeã‚¹ã‚¿ãƒ³ãƒ—11.png" alt="11"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="YouTubeã‚¹ã‚¿ãƒ³ãƒ—12.png" alt="12"><div class="qmark-overlay"></div></div>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-label">ãƒ¡ãƒ³ãƒãƒ¼ãƒãƒƒã‚¸</div>
      <div class="grid-wrapper">
        <div class="image-grid" id="badgeGrid">
          <!-- â˜… ãƒãƒƒã‚¸ç”»åƒã‚’è¿½åŠ ãƒ»å‰Šé™¤ã™ã‚‹ã«ã¯ã“ã“ã‚’ç·¨é›† -->
          <div class="img-cell"><img src="ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ã‚ªãƒ‹ã‚®ãƒªãƒ©ã‚¯ãƒ¼ãƒ³1.png" alt="1"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ã‚ªãƒ‹ã‚®ãƒªãƒ©ã‚¯ãƒ¼ãƒ³2.png" alt="2"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ã‚ªãƒ‹ã‚®ãƒªãƒ©ã‚¯ãƒ¼ãƒ³3.png" alt="3"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ã‚ªãƒ‹ã‚®ãƒªãƒ©ã‚¯ãƒ¼ãƒ³4.png" alt="4"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ã‚ªãƒ‹ã‚®ãƒªãƒ©ã‚¯ãƒ¼ãƒ³5.png" alt="5"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ã‚ªãƒ‹ã‚®ãƒªãƒ©ã‚¯ãƒ¼ãƒ³6.png" alt="6"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ã‚ªãƒ‹ã‚®ãƒªãƒ©ã‚¯ãƒ¼ãƒ³7.png" alt="7"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ã‚ªãƒ‹ã‚®ãƒªãƒ©ã‚¯ãƒ¼ãƒ³8.png" alt="8"><div class="qmark-overlay"></div></div>
          <div class="img-cell"><img src="ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ã‚ªãƒ‹ã‚®ãƒªãƒ©ã‚¯ãƒ¼ãƒ³9.png" alt="9"><div class="qmark-overlay"></div></div>
        </div>
      </div>
    </div>

  </div>

  <div class="bottom-area">
    <div class="bottom-hearts">â™¡ â™¡ â™¡ â™¡ â™¡</div>
    <div class="bottom-line"></div>
    <div class="bottom-text">â™¡ join the membership â™¡</div>
  </div>
</div>

<button class="save-btn" id="saveBtn">ğŸ€ ç”»åƒã¨ã—ã¦ä¿å­˜ ğŸ€</button>
<p class="hint">ã‚¯ãƒªãƒƒã‚¯ã§ï¼Ÿãƒãƒ¼ã‚¯ â†’ ä¿å­˜ãƒœã‚¿ãƒ³ã§ç”»åƒåŒ–</p>

<!-- html2canvas ã‚’äº‹å‰èª­ã¿è¾¼ã¿ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
// â”€â”€ ? SVG ã‚’å„overlayã«æ³¨å…¥ â”€â”€
const Q = `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
  <circle cx="50" cy="50" r="49" fill="#1a1a1a"/>
  <circle cx="50" cy="50" r="47" fill="none" stroke="#ffffff" stroke-width="2.5"/>
  <text x="50" y="68"
    text-anchor="middle"
    font-family="'Kaisei Tokumin',serif"
    font-size="58" font-weight="800"
    fill="#ffffff">?</text>
</svg>`;
document.querySelectorAll('.qmark-overlay').forEach(el => el.innerHTML = Q);

// â”€â”€ bg deco â”€â”€
const bd = document.getElementById('bgDeco');
['â™¡','â™¡','â™¡','ğŸ€','â™¡','â™¡'].forEach(() => {
  for (let i = 0; i < 5; i++) {
    const s = document.createElement('span');
    s.textContent = ['â™¡','â™¡','â™¡','ğŸ€','â™¡'][Math.floor(Math.random()*5)];
    s.style.left = Math.random()*100+'%';
    s.style.fontSize = (11+Math.random()*15)+'px';
    s.style.animationDuration = (11+Math.random()*12)+'s';
    s.style.animationDelay = (Math.random()*16)+'s';
    bd.appendChild(s);
  }
});

// â”€â”€ auto grid cols â”€â”€
function autoGrid(el) {
  const n = el.querySelectorAll('.img-cell').length;
  el.style.setProperty('--cols', Math.ceil(Math.sqrt(n)));
}
autoGrid(document.getElementById('stampGrid'));
autoGrid(document.getElementById('badgeGrid'));

// â”€â”€ toggle ? â”€â”€
document.querySelectorAll('.img-cell').forEach(c =>
  c.addEventListener('click', () => c.classList.toggle('hidden-mode'))
);

// â”€â”€ ç”»åƒã‚’base64ã«å¤‰æ›ã—ã¦CORSå•é¡Œã‚’å›é¿ â”€â”€
async function inlineImages(clone) {
  const imgs = clone.querySelectorAll('img');
  await Promise.all([...imgs].map(async img => {
    try {
      const res = await fetch(img.src);
      const blob = await res.blob();
      const b64 = await new Promise(r => {
        const fr = new FileReader();
        fr.onload = () => r(fr.result);
        fr.readAsDataURL(blob);
      });
      img.src = b64;
    } catch { /* èª­ã‚ãªã‘ã‚Œã°ãã®ã¾ã¾ */ }
  }));
}

// â”€â”€ SAVE â”€â”€
document.getElementById('saveBtn').addEventListener('click', async () => {
  const btn = document.getElementById('saveBtn');
  btn.disabled = true;
  btn.textContent = 'â³ ä¿å­˜ä¸­...';

  const card = document.getElementById('mainCard');

  try {
    // ã‚«ãƒ¼ãƒ‰ã‚’cloneã—ã¦base64ç”»åƒã«å·®ã—æ›¿ãˆ
    const clone = card.cloneNode(true);
    clone.style.position = 'fixed';
    clone.style.left = '-9999px';
    clone.style.top = '0';
    document.body.appendChild(clone);
    await inlineImages(clone);

    const cvs = await html2canvas(clone, {
      backgroundColor: '#ffffff',
      scale: 2,
      useCORS: false,
      allowTaint: true,
      logging: false,
      width: card.offsetWidth,
      height: card.offsetHeight,
    });

    document.body.removeChild(clone);

    const a = document.createElement('a');
    a.download = 'å¾¡æ‰‹æ´—éŠãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—.png';
    a.href = cvs.toDataURL('image/png');
    a.click();
  } catch(e) {
    alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ©Ÿèƒ½ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚\n' + e);
  } finally {
    btn.disabled = false;
    btn.textContent = 'ğŸ€ ç”»åƒã¨ã—ã¦ä¿å­˜ ğŸ€';
  }
});
</script>
</body>
</html>
